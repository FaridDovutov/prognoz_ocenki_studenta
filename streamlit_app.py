import streamlit as st
import joblib
import pandas as pd
import numpy as np
from sklearn.base import BaseEstimator, TransformerMixin

# --- 0. –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ì–û –¢–†–ê–ù–°–§–û–†–ú–ê–¢–û–†–ê (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!) ---
# –ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–¥–µ–Ω—Ç–∏—á–µ–Ω –∫–ª–∞—Å—Å—É –≤ —Ñ–∞–π–ª–µ –æ–±—É—á–µ–Ω–∏—è.
# –ú—ã –æ—Å—Ç–∞–≤–ª—è–µ–º —ç—Ç–æ—Ç –∫–ª–∞—Å—Å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–∑–∞–≥—Ä—É–∑–∫–∏) –º–æ–¥–µ–ª–∏,
# –Ω–æ –µ–≥–æ –ª–æ–≥–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä—è–º–æ–º –≤—ã–∑–æ–≤–µ predict, –±—É–¥–µ—Ç
# —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤—Ä—É—á–Ω—É—é –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ 'Weekly_Study_Hours' –ø–µ—Ä–µ–¥ predict.
class RangeToMean(BaseEstimator, TransformerMixin):
    """–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∑–∞–ø—è—Ç—ã–µ –≤ —Ç–æ—á–∫–∏."""
    def fit(self, X, y=None):
        return self

    def transform(self, X):
        X_out = X.copy()
        
        # ! –í–ù–ò–ú–ê–ù–ò–ï: –ï—Å–ª–∏ —ç—Ç–æ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä –≤ –≤–∞—à–µ–º –∫–æ–Ω–≤–µ–π–µ—Ä–µ (pipeline) –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
        # ! –¢–û–õ–¨–ö–û –∫ 'Weekly_Study_Hours', —Ç–æ —Ü–∏–∫–ª 'for col in X_out.columns'
        # ! –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–¥–∞–ª–µ–Ω –ò–õ–ò –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞/—Å—Ç–æ–ª–±—Ü–æ–≤,
        # ! —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!
        
        # –ß—Ç–æ–±—ã –Ω–µ –∏–∑–º–µ–Ω—è—Ç—å –∫–ª–∞—Å—Å (–ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –æ–±—É—á–µ–Ω–Ω—ã–º),
        # –º—ã –æ—Å—Ç–∞–≤–∏–º –µ–≥–æ –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–£–ß–ù–û–ï –ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–ï
        # –≤ —Ñ—É–Ω–∫—Ü–∏–∏ main –ü–ï–†–ï–î –ø–æ–¥–∞—á–µ–π –¥–∞–Ω–Ω—ã—Ö –≤ predict, —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ –æ—à–∏–±–∫—É
        # 'isnan' –≤ —ç—Ç–æ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–µ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤.
        
        # –ï—Å–ª–∏ –≤–∞—à–∞ –æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç ColumnTransformer, RangeToMean
        # –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã. –ï—Å–ª–∏ –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ,
        # –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω –±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤–æ. –î–ª—è —Ü–µ–ª–µ–π Streamlit
        # –º—ã –ø—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∫ predict –ø–æ–¥–∞—é—Ç—Å—è —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

        # ... (–û—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –∫–ª–∞—Å—Å–∞ RangeToMean –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        for col in X_out.columns:
            def convert_range(value):
                # –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ - —Å—Ç—Ä–æ–∫–∞, —É–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                if isinstance(value, str):
                    value = value.strip()
                    # –®–∞–≥ 1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —Ç–∏–ø–∞ '19-22'
                    if '-' in value:
                        try:
                            parts = value.replace(',', '.').split('-')
                            lower, upper = map(float, parts)
                            return (lower + upper) / 2
                        except ValueError:
                            return np.nan
                    
                # –®–∞–≥ 2: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—Ä–æ—Å—Ç—ã—Ö —á–∏—Å–µ–ª –∏ —Å—Ç—Ä–æ–∫ —Å –∑–∞–ø—è—Ç—ã–º–∏ –≤ float
                try:
                    if isinstance(value, str):
                        value = value.replace(',', '.')
                    return float(value)
                except (ValueError, TypeError):
                    return np.nan

            X_out[col] = X_out[col].apply(convert_range)
        
        X_out = X_out.fillna(X_out.median(numeric_only=True))
        
        return X_out


# --- –°–õ–û–í–ê–†–ò –°–û–ü–û–°–¢–ê–í–õ–ï–ù–ò–ô (MAPPING) ---
# –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç —Å –æ–∂–∏–¥–∞–µ–º—ã–º–∏ –ª–∞—Ç–∏–Ω—Å–∫–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –º–æ–¥–µ–ª–∏
MAPPING = {
    '–ú—É–∂—Å–∫–æ–π / Male': 'Male',
    '–ñ–µ–Ω—Å–∫–∏–π / Female': 'Female',
    '–ì–æ—Ä–æ–¥—Å–∫–∞—è / Urban': 'Urban',
    '–°–µ–ª—å—Å–∫–∞—è / Rural': 'Rural',
    '–î–∞ / Yes': 'Yes',
    '–ù–µ—Ç / No': 'No',
    '–•–æ—Ä–æ—à–æ / Good': 'Good',
    '–°—Ä–µ–¥–Ω–µ / Average': 'Average',
    '–ü–ª–æ—Ö–æ / Poor': 'Poor',
    '–ê–≤—Ç–æ–±—É—Å / Bus': 'Bus',
    '–õ–∏—á–Ω—ã–π / Private': 'Private',
    '–î—Ä—É–≥–æ–µ / Other': 'Other'
}


# --- –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ó–ê–ì–†–£–ó–ö–ê –ú–û–î–ï–õ–ò ---

try:
    best_model = joblib.load('student_grade_predictor.pkl')
    MODEL_LOADED = True
except FileNotFoundError:
    st.error("–•–∞—Ç–æ–≥”£: –§–∞–π–ª–∏ –º–æ–¥–µ–ª 'student_grade_predictor.pkl' —ë—Ñ—Ç –Ω–∞—à—É–¥. –õ—É—Ç—Ñ–∞–Ω, –∞–≤–≤–∞–ª —Å–∫—Ä–∏–ø—Ç–∏ –æ–º”Ø–∑–∏—à—Ä–æ –∏“∑—Ä–æ –∫—É–Ω–µ–¥.")
    MODEL_LOADED = False
except Exception as e:
    # –í–∞–∂–Ω–æ: –∑–¥–µ—Å—å –º—ã –ø–µ—á–∞—Ç–∞–µ–º e, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —Å–≤—è–∑–∞–Ω–∞ –ª–∏ –æ—à–∏–±–∫–∞ —Å RangeToMean
    # –Ω–∞ —ç—Ç–∞–ø–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏).
    st.error(f"–•–∞—Ç–æ–≥”£ “≥–∞–Ω–≥–æ–º–∏ –±–æ—Ä–∫—É–Ω–∏–∏ –º–æ–¥–µ–ª: {e}")
    MODEL_LOADED = False


INPUT_FEATURES = ['Student_Age', 'Sex', 'High_School_Type', 'Scholarship', 'A6itional_Work', 
                  'Sports_activity', 'Transportation', 'Weekly_Study_Hours', 'Attendance', 
                  'Reading', 'Notes', 'Listening_in_Class', 'Project_work']

# --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–Ø –î–ò–ê–ü–ê–ó–û–ù–û–í (–∏–∑ RangeToMean, —Ç–æ–ª—å–∫–æ –¥–ª—è 'Weekly_Study_Hours') ---

def manual_convert_weekly_study_hours(value_str):
    """–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫—É –¥–∏–∞–ø–∞–∑–æ–Ω–∞ ('10-15') –∏–ª–∏ —á–∏—Å–ª–æ–≤—É—é —Å—Ç—Ä–æ–∫—É ('20') –≤ float."""
    # 1. –ó–∞–º–µ–Ω–∞ –∑–∞–ø—è—Ç—ã—Ö –Ω–∞ —Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    value_str = str(value_str).strip().replace(',', '.')
    
    # 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
    if '-' in value_str:
        try:
            parts = value_str.split('-')
            lower, upper = map(float, parts)
            return (lower + upper) / 2
        except ValueError:
            # –ï—Å–ª–∏ –Ω–µ —Å–º–æ–≥–ª–∏ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º NaN
            return np.nan
            
    # 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ —á–∏—Å–ª–∞
    try:
        return float(value_str)
    except (ValueError, TypeError):
        return np.nan

# --- –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---

def main():
    st.title("üéì –ü–µ—à–≥”Ø–∏–∏ –±–∞“≥–æ–∏ –∏–º—Ç–∏“≥–æ–Ω–æ—Ç–∏–∏ –¥–æ–Ω–∏—à“∑”Ø–π (–ê–∑ —Ä”Ø–∏ —Å–∏—Å—Ç–µ–º–∞–∏ 100-—Ö–æ–ª–∞)")
    st.markdown("–ë–∞—Ä–æ–∏ –±–∞ –¥–∞—Å—Ç –æ–≤–∞—Ä–¥–∞–Ω–∏ –±–∞“≥–æ–∏ –Ω–∏“≥–æ”£ –¥–æ–¥–∞“≥–æ–∏ –¥–æ–Ω–∏—à“∑”Ø–π—Ä–æ –¥–æ—Ö–∏–ª –Ω–∞–º–æ–µ–¥.")
    
    if not MODEL_LOADED:
        return

    # --- –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º –≤–≤–æ–¥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ---
    with st.form("student_data_form"):
        # –†–∞–∑–¥–µ–ª 1: –î–µ–º–æ–≥—Ä–∞—Ñ–∏—è
        st.header("1. –î–æ–¥–∞“≥–æ–∏ –¥–µ–º–æ–≥—Ä–∞—Ñ”£ –≤–∞ –º–∞–∫—Ç–∞–±”£")
        col1, col2, col3 = st.columns(3)
        
        # –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –≤–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å int
        student_age = col1.number_input("–°–∏–Ω–Ω—É —Å–æ–ª–∏ –¥–æ–Ω–∏—à“∑”Ø–π", min_value=15, max_value=30, value=18, step=1)
        sex_display = col2.selectbox("“∂–∏–Ω—Å", ["–ú—É–∂—Å–∫–æ–π / Male", "–ñ–µ–Ω—Å–∫–∏–π / Female"])
        high_school_type_display = col3.selectbox("–ù–∞–º—É–¥–∏ –º–∞–∫—Ç–∞–±", ["–ì–æ—Ä–æ–¥—Å–∫–∞—è / Urban", "–°–µ–ª—å—Å–∫–∞—è / Rural"])
        
        # –†–∞–∑–¥–µ–ª 2: –†–µ—Å—É—Ä—Å—ã –∏ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        st.header("2. –ú–∞–Ω–±–∞“≥–æ –≤–∞ —Ñ–∞—ä–æ–ª–∏—è—Ç")
        col4, col5, col6 = st.columns(3)
        
        scholarship_display = col4.selectbox("–°—Ç–∏–ø–µ–Ω–¥–∏—è", ["–î–∞ / Yes", "–ù–µ—Ç / No"])
        additional_work_display = col5.selectbox("“∂–æ–π–∏ –∫–æ—Ä–∏ –∏–ª–æ–≤–∞–≥”£", ["–î–∞ / Yes", "–ù–µ—Ç / No"], key='A6itional_Work')
        sports_activity_display = col6.selectbox("–í–∞—Ä–∑–∏—à", ["–î–∞ / Yes", "–ù–µ—Ç / No"])

        transportation_display = st.selectbox("–í–æ—Å–∏—Ç–∞–∏ –Ω–∞“õ–ª–∏—ë—Ç", ["–ê–≤—Ç–æ–±—É—Å / Bus", "–õ–∏—á–Ω—ã–π / Private", "–î—Ä—É–≥–æ–µ / Other"])
        # –û—Å—Ç–∞–≤–ª—è–µ–º –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞
        weekly_study_hours = st.text_input("–°–æ–∞—Ç“≥–æ–∏ —Ç–∞—ä–ª–∏–º–∏–∏ “≥–∞—Ñ—Ç–∞–∏–Ω–∞ (–º–∞—Å–∞–ª–∞–Ω, 10-15 —ë 20)", value="10-15")
        attendance = st.slider("–§–æ–∏–∑–∏ –∏—à—Ç–∏—Ä–æ–∫ –¥–∞—Ä –¥–∞—Ä—Å (%)", min_value=0, max_value=100, value=90)
        
        # –†–∞–∑–¥–µ–ª 3: –£—á–µ–±–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
        st.header("3. –§–∞—ä–æ–ª–∏—è—Ç–∏ —Ç–∞—ä–ª–∏–º”£")
        
        reading_display = st.selectbox("–•–æ–Ω–¥–∞–Ω–∏ –∞–¥–∞–±–∏—ë—Ç–∏ –∏–ª–æ–≤–∞–≥”£", ["–î–∞ / Yes", "–ù–µ—Ç / No"])
        notes_display = st.selectbox("–ù–∞–≤–∏—à—Ç–∞–Ω–∏ –º–∞—Ç–Ω–∏ –ª–µ–∫—Å–∏—è“≥–æ", ["–î–∞ / Yes", "–ù–µ—Ç / No"])
        listening_in_class_display = st.selectbox("–î–∞—Ä –¥–∞—Ä—Å“≥–æ –±–æ–¥–∏“õ“õ–∞—Ç –∞—Å—Ç", ["–î–∞ / Yes", "–ù–µ—Ç / No"])
        project_work_display = st.selectbox("–°–∏—Ñ–∞—Ç–∏ –∫–æ—Ä“≥–æ–∏ —Å—É–ø–æ—Ä–∏—à”£", ["–•–æ—Ä–æ—à–æ / Good", "–°—Ä–µ–¥–Ω–µ / Average", "–ü–ª–æ—Ö–æ / Poor"])
        
        submitted = st.form_submit_button("–ü–µ—à–≥”Ø–∏–∏ –±–∞“≥–æ")

    # --- –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è ---
    if submitted:
        
        # !!! –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –®–ê–ì –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø: –ü–†–ï–û–ë–†–ê–ó–£–ï–ú Weekly_Study_Hours –í–†–£–ß–ù–£–Æ !!!
        
        # 1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ 'Weekly_Study_Hours' –≤ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (float)
        processed_weekly_hours = manual_convert_weekly_study_hours(weekly_study_hours)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–¥–∞–ª–æ—Å—å –ª–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
        if np.isnan(processed_weekly_hours):
             st.error("–•–∞—Ç–æ–≥”£: –§–æ—Ä–º–∞—Ç '–°–æ–∞—Ç“≥–æ–∏ —Ç–∞—ä–ª–∏–º–∏–∏ “≥–∞—Ñ—Ç–∞–∏–Ω–∞' –Ω–æ–¥—É—Ä—É—Å—Ç –∞—Å—Ç. –õ—É—Ç—Ñ–∞–Ω, –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥, –º–∞—Å–∞–ª–∞–Ω, '10-15' —ë '20'.")
             return

        # 2. –°–æ–∑–¥–∞–Ω–∏–µ DataFrame —Å —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º —á–∏—Å–ª–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –¥–ª—è weekly_study_hours
        input_data = pd.DataFrame({
            # –ß–∏—Å–ª–æ–≤—ã–µ
            'Student_Age': [float(student_age)],
            'Attendance': [float(attendance)],
            'Weekly_Study_Hours': [processed_weekly_hours], # –¢–µ–ø–µ—Ä—å —ç—Ç–æ float, –∞ –Ω–µ —Å—Ç—Ä–æ–∫–∞
            
            # –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ (–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–æ–≤–∞—Ä—å MAPPING)
            'Sex': [MAPPING[sex_display]],
            'High_School_Type': [MAPPING[high_school_type_display]],
            'Scholarship': [MAPPING[scholarship_display]],
            'A6itional_Work': [MAPPING[additional_work_display]],
            'Sports_activity': [MAPPING[sports_activity_display]],
            'Transportation': [MAPPING[transportation_display]],
            'Reading': [MAPPING[reading_display]],
            'Notes': [MAPPING[notes_display]],
            'Listening_in_Class': [MAPPING[listening_in_class_display]],
            'Project_work': [MAPPING[project_work_display]]
        })
        
        # –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤
        input_data = input_data[INPUT_FEATURES]

        try:
            # –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ Weekly_Study_Hours —É–∂–µ —á–∏—Å–ª–æ–≤–æ–π, RangeToMean
            # (–µ—Å–ª–∏ –æ–Ω –≤ –∫–æ–Ω–≤–µ–π–µ—Ä–µ –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º —Å—Ç–æ–ª–±—Ü–∞–º)
            # —Å–º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —Å—Ç–æ–ª–±–µ—Ü, –∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã
            # –Ω–µ –±—É–¥—É—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω—ã –≤ NaN, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç ColumnTransformer
            # –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä–æ–∫–∏.
            prediction = best_model.predict(input_data)[0]
            predicted_score = round(prediction, 2)

            st.success(f"### üéØ –ü–µ—à–≥”Ø–∏–∏ –±–∞“≥–æ–∏ –∏–º—Ç–∏“≥–æ–Ω–æ—Ç–∏–∏ –Ω–∏“≥–æ”£ (–∞–∑ 100-—Ö–æ–ª):")
            st.success(f"## {predicted_score}")
            
            st.info(f"–ò–Ω –±–∞“≥–æ –±–∞ {round(predicted_score/10, 2)} –∞–∑ —Ä”Ø–∏ —Å–∏—Å—Ç–µ–º–∞–∏ 10-—Ö–æ–ª–∞ –±–∞—Ä–æ–±–∞—Ä –∞—Å—Ç.")
            
        except Exception as e:
            st.error(f"“≤–∞–Ω–≥–æ–º–∏ –ø–µ—à–≥”Ø–∏–∫—É–Ω”£ —Ö–∞—Ç–æ–≥”£ –ø–∞–π–¥–æ —à—É–¥: {e}")
            st.warning("–°–∞–Ω“∑–µ–¥, –∫–∏ “≥–∞–º–∞–∏ –ø–æ–ª—è“≥–æ –ø—É—Ä –∫–∞—Ä–¥–∞ —à—É–¥–∞–∞–Ω–¥ –≤–∞ '–°–æ–∞—Ç“≥–æ–∏ —Ç–∞—ä–ª–∏–º–∏–∏ “≥–∞—Ñ—Ç–∞–∏–Ω–∞' –¥–∞—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10-15 –∏–ª–∏ 20).")


if __name__ == '__main__':
    main()
